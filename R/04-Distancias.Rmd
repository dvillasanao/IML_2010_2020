# M√©todo de Distancias $DP2$  {.unlisted .unnumbered}


Jos√© Bernardo Pena Trapero: `Problemas de la medici√≥n del bienestar y conceptos afines (1977)` 

Los m√©todos de distancias son enfoques utilizados para medir el bienestar o la calidad de vida de las personas a trav√©s de la comparaci√≥n de diferentes dimensiones o indicadores. Estos m√©todos se basan en la idea de que el bienestar se puede evaluar considerando la distancia o diferencia entre los individuos en t√©rminos de ciertos atributos o variables relevantes.   
La Distancia $DP_{2}$, es un indicador sint√©tico, definido por el profesor `J. Bernardo Pena Trapero`, basado en el concepto de distancia, construido, como su nombre indica para medir distancias entre unidades geogr√°ficas, o bien, tambi√©n se puede aplicar a comparaciones tanto cronol√≥gicas como interespaciales.     
   

**Definici√≥n**

Sean:   

$\:\:\circ\:r$, el n√∫mero de localidades;  
$\:\:\circ\:n$, el n√∫mero de variables;  
$\:\:\circ\:x_{ij}$, el valor de la variable $j$ en la localidad $i$;  
$\:\:\circ\:\sigma_{j}$, La Desviaci√≥n T√≠pica de la variable $j$;   
$\:\:\circ\:R^{2}_{i,i-1,...,1}$ el Coeficiente de Determinaci√≥n en la Regresi√≥n de $X_{i}$ sobre $X_{i-1},X_{i-2},...,X_{1}$. 

Se define la $Distancia-P_{2}$ de la forma:    

\begin{align}
DP_{2}=\sum^{n}_{i=1}\frac{d_{i}}{\sigma_{i}}(1-R^{2}_{i,i-1,...,1})\:\:;\;\;con \:\:R^{2}_{1}=0
\end{align}

Donde:     

$\:\:\circ\:d_{i} = d_{i}(r,*) = |x_{ri}-x_{*i}|$ |: es la distancia de la j-√©sima variable de la localidad $r$ con respecto a la base de referencia $x_{*}=(x_{*1}, x_{*2},..., x_{*n})$. Tomando como punto de referencia el valor m√≠nimo de la variable, siendo esta la peor situaci√≥n te√≥rica,      

 $\:\:\circ\:\sigma_{i}$ : es la desviaci√≥n est√°ndar de la variable $ùëó$,     
 
 $\:\:\circ\:R^{2}_{i,i-1,...,1}$: es el coeficiente de determinaci√≥n de la regresi√≥n del indicador parcial $ùëó$ con respecto a los otros indicadores $(ùëó‚àí1,ùëó‚àí2,‚Ä¶,1)$. Esta expresi√≥n es parte de la varianza del indicador parcial $I_{j}$ que se explica linealmente por el resto de los indicadores parciales,        

$\:\:\circ\:(1-R^{2}_{i,i-1,...,1})$): es el factor corrector que evita la duplicidad, al eliminar la informaci√≥n parcial de los indicadores ya contenidos en los indicadores precedentes, y     

$\:\:\circ\:R^{2}_{1}=0$; porque la primera componente aporta toda la informaci√≥n y al no existir un componente previo su ponderaci√≥n es la unidad.  

El $DP_{2}$ cumple con las siguientes propiedades: no negatividad, homogeneidad, conmutatividad, desigualdad triangular, existencia y determinaci√≥n, monoton√≠a, unicidad, transitividad, no duplicidad de informaci√≥n, invariancia al cambio de origen y/o de escala en las unidades y exhaustividad.      


El orden de entrada de las variables

```{r}
# Se multiplica por -1, debido a que son indicadores de carencia 
for(i in tablas){	
  assign(paste0("DP2_datos_", i), (-1 * get(paste0("tabla_", i))[10:17]))
}
```


## Base de referencia  {-}
Se toma como base de referencia el valor del m√≠nimo del `2010 - 2020`, ya que este tipo de cambio permite la comparabilidad en el tiempo. 


```{r}
#Base de referencia 2010 - 2020
for(i in tablas){
assign(paste0("minRV_", i), setNames(c(-100, # ANALF
                                       -100, # SBASC
                                       -100, # OVSDE
                                       -100, # OVSEE
                                       -100, # OVSAE
                                       -100, # OVPT
                                       -100, # OVHAC
                                       -100), # OVSREF
                              nm = c("ANALF", "SBASC", "OVSDE", "OVSEE", "OVSAE", "OVPT", "OVHAC", "OVSREF")))
}
```


```{r, echo = FALSE}
minRV <- minRV_2010 %>%
          t() %>%
           as.data.frame() %>%
            tibble::rownames_to_column(.data = .) %>%
             dplyr::mutate(rowname = case_when(rowname %in% 1 ~ "2010 - 2020")) %>%
              rename("ANIO" = "rowname")

minRV %>% 
  rename("A√ëO" = "ANIO") %>%
   gt() %>%
    tab_header(title = "Base de referencia") %>%
     fmt_number(columns = names(tabla_2020)[10:17], 
                decimals = 2) %>%
      tab_options(heading.title.font.size = 12, 
                  heading.align = "center",
                  heading.subtitle.font.size = 10,
                  table.align = "center",
                  table.font.names = 'montserrat',
                  table.font.size = 8) %>%
       tab_style(style = list(cell_text(align = "center",
                                         weight = 'bold')),
                  locations = list(cells_title(groups = c("title")))) %>%
        tab_style(style = list(cell_text(align = "left")),
                   locations = list(cells_title(groups = c("subtitle")))) %>%
         cols_label(A√ëO = md("**A√ëO**"), 
                    ANALF = md("**ANALF**"),
                    SBASC = md("**SBASC**"),
                    OVSDE = md("**OVSDE**"),
                    OVSEE = md("**OVSEE**"),
                    OVSAE = md("**OVSAE**"),
                    OVPT= md("**OVPT**"),
                    OVHAC = md("**OVHAC**"),
                    OVSREF = md("**OVSREF**")) %>%
          as_raw_html() 
```



## M√©todo de Distancia $DP_{2}$  {-}   

```{r, results=FALSE}
require(p2distance)
##Calculo del M√©todo de Distancias DP2
for(i in tablas){
assign(paste0("ind_", i), p2distance(matriz = as.matrix(get(paste0("DP2_datos_", i))), 
                                      reference_vector = get(paste0("minRV_", i)), 
                                       iterations = 50))
}
```

**Total de iteraciones** 

```{r, collapse=TRUE}
iteration <- lapply(1:2, function(x) get(paste0("ind_", tablas[x]))[["iteration"]])
```


```{r, echo=FALSE}
tabla <- do.call(rbind, iteration) %>%
                  as.data.frame() %>%
                   tibble::rownames_to_column(.data = .) %>%
                    dplyr::mutate(rowname = case_when(rowname %in% 1 ~ "2010",
                                                      rowname %in% 2 ~ "2020")) %>%
                     rename("ANIO" = "rowname")

tabla %>% 
 rename("A√ëO" = "ANIO") %>%
  gt() %>%
   tab_header(title = "N√∫mero de iteraciones") %>%
    fmt_integer(columns = "V1") %>%
     tab_options(heading.title.font.size = 12, 
                 heading.subtitle.font.size = 10,
                 table.font.names = 'montserrat',
                 table.align = "center",
                 table.font.size = 8,
                 data_row.padding = px(1)) %>%
      tab_style(style = list(cell_text(align = "left",
                                        weight = 'bold')),
                 locations = list(cells_title(groups = c("title")))) %>%
       tab_style(style = list(cell_text(align = "left")),
                  locations = list(cells_title(groups = c("subtitle")))) %>%
        cols_label(A√ëO = md("**A√ëO**"), 
                    V1 = md("**Iteraciones**")) %>%
         as_raw_html() 
```




Se anexan los resultados a las bases de datos original

```{r}
for(i in tablas){
assign(paste0("DP2_", i), cbind(get(paste0("tabla_", i)), get(paste0("ind_", i))[["p2distance"]]))
}

# Se cambian los nombres de las columnas 
for(i in 1:2){
  columns = get(paste0("DP2_", tablas[i]))
  colnames(columns) = c("CVE_LOC", "ENT", "NOM_ENT", "MUN", "NOM_MUN", "LOC", "NOM_LOC", "POB_TOT", "ANIO",
                        "ANALF", "SBASC", "OVSDE", "OVSEE", "OVSAE", "OVPT", "OVHAC", "OVSREF",
                        paste0("IM_", tablas[i]))
  assign(paste0("DP2_", tablas[i]), columns)
  rm(columns)
}
```
